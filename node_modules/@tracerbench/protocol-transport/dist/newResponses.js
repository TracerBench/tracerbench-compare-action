import { oneshot } from "race-cancellation";
export default function newResponses() {
    let seq = 0;
    const pending = new Map();
    return [usingResponse, resolveResponse];
    function resolveResponse(response) {
        const resolve = pending.get(response.id);
        if (resolve !== undefined) {
            resolve(response);
        }
    }
    async function usingResponse(using) {
        const id = seq++;
        try {
            const [response, resolve] = oneshot();
            pending.set(id, resolve);
            return await using(id, response);
        }
        finally {
            pending.delete(id);
        }
    }
}
//# sourceMappingURL=newResponses.js.map